var tssDeepLink=function(e,t=!1,n={},r=null){let a={context:{range:[],scope:{},variables:{}},messengers:[{key:"?",name:"telegram",parameter:"start",prefixes:["tg://","https://t.me/"]},{key:"?",name:"facebook",parameter:"ref",prefixes:["https://m.me/"]},{key:"?",name:"instagram",parameter:"ref",prefixes:["https://ig.me/"]},{key:"#",name:"vkontakte",parameter:"r",prefixes:["https://vk.com/","vk://"]},{key:"?",name:"viber",parameter:"context",prefixes:["viber://"]},{key:"?",name:"wa",parameter:"text",prefixes:["https://wa.me","whatsapp://"]}],delimiter:"|",url:"https://"+e+".customer.smartsender.eu/api/i/store"};function o(){var e=document.querySelectorAll(".js-form-proccess");Array.prototype.forEach.call(e,(function(e){e.addEventListener("tildaform:aftersuccess",(function(t){t.preventDefault(),i(e)}))}))}function i(e){if(console.log("func form"),!e)return;e instanceof jQuery&&(e=e.get(0));var o={},i=e.elements;Array.prototype.forEach.call(i,(function(e){"radio"===e.type?e.checked&&(o[e.name]=e.value):-1==e.name.indexOf("tildaspec")&&(o[e.name]=e.value)})),o.Phone&&!o.phone&&(o.phone=o.Phone),o.phone&&(o.phone=o.phone.replace(/[^\d\+]/g,"")),o.Email&&!o.email&&(o.email=o.Email);var s=e.getAttribute("data-success-url");if(!s&&r&&(s=r),a.messengers.find((function(e){return e.prefixes.find((function(e){return 0===s.indexOf(e)}))}))){console.log("func is messenger");var l={};if(l.variables=o,n.variables)for(key in n.variables)l.variables[key]=n.variables[key];else for(key in n)l.variables[key]=n[key];let e=new XMLHttpRequest;e.open("POST",a.url),e.setRequestHeader("Content-type","application/json"),e.setRequestHeader("X-Requested-With","XMLHttpRequest"),e.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let e=JSON.parse(this.responseText);location.href=function(e,t){console.log("generate url");let n=a.messengers.find((function(t){return t.prefixes.find((function(t){return 0===e.indexOf(t)}))}));if(!n)return e;let r=e.split(n.key),o=r[1].split("&");return o.forEach((function(e,r){let i=e.split("=");if(n.parameter===i[0])if("wa"===n.name){let e=i[1].split("+"),s=e.length,l=i[1].replace(e[s-1],btoa(atob(e[s-1])+a.delimiter+t.id).replace(/=/g,""));o.splice(r,1,[n.parameter,l].join("="))}else{let e=btoa(atob(i[1])+a.delimiter+t.id).replace(/=/g,"");o.splice(r,1,[n.parameter,e].join("="))}})),r[0]+n.key+o.join("&")}(s,e)}},e.send(function(e){return console.log("create context"),Object.keys(a.context).forEach((function(t){Object.keys(e).includes(t)||(e[t]={})})),JSON.stringify(t?function(e){return new URLSearchParams(window.location.search).forEach((function(t,n){e.variables.hasOwnProperty(n)||(e.variables[n]=t)})),e}(e):e)}(l))}else{if(console.log("func is not messenger"),n.variables)for(key in n.variables)o[key]=n.variables[key];else for(key in n)o[key]=n[key];location.href=s+"?"+function(e,t){if(void 0===e||"object"!=typeof e)return e;let n=[];for(let r in e)if(e.hasOwnProperty(r)){let a=t?t+"["+r+"]":r,o=e[r];n.push("object"==typeof v?serialize(o,a):encodeURIComponent(a)+"="+encodeURIComponent(o))}return n.join("&")}(t?(c=o,new URLSearchParams(window.location.search).forEach((function(e,t){c.hasOwnProperty(t)||(c[t]=e)})),c):o)}var c}"loading"!==document.readyState?o():document.addEventListener("DOMContentLoaded",o)};

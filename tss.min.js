var tssDeepLink=function(e,t=!1,r={},n=null){let a={context:{range:[],scope:{},variables:{}},messengers:[{key:"?",name:"telegram",parameter:"start",prefixes:["tg://","https://t.me/"]},{key:"?",name:"facebook",parameter:"ref",prefixes:["https://m.me/"]},{key:"?",name:"instagram",parameter:"ref",prefixes:["https://ig.me/"]},{key:"#",name:"vkontakte",parameter:"r",prefixes:["https://vk.com/","vk://"]},{key:"?",name:"viber",parameter:"context",prefixes:["viber://"]},{key:"?",name:"wa",parameter:"text",prefixes:["https://wa.me","whatsapp://"]},],delimiter:"|",url:"https://"+e+".customer.smartsender.eu/api/i/store"};function i(){var e=document.querySelectorAll(".js-form-proccess");Array.prototype.forEach.call(e,function(e){e.addEventListener("tildaform:aftersuccess",function(t){t.preventDefault(),o(e)})})}function s(e){o(e)}function o(e){if(console.log("func form"),e){e instanceof jQuery&&(e=e.get(0));var i={},s=e.elements;Array.prototype.forEach.call(s,function(e){"radio"===e.type?e.checked&&(i[e.name]=e.value):-1==e.name.indexOf("tildaspec")&&(i[e.name]=e.value)}),i.tranId=e.tildaTranId,i.orderId=e.tildaOrderId,i.Phone&&!i.phone&&(i.phone=i.Phone),i.phone&&(i.phone=i.phone.replace(/[^\d\+]/g,"")),i.Email&&!i.email&&(i.email=i.Email);var o=e.getAttribute("data-success-url");!o&&n&&(o=n);if(a.messengers.find(function(e){return e.prefixes.find(function(e){return 0===o.indexOf(e)})})){console.log("func is messenger");var p,u,d={};if(d.variables=i,r.variables)for(key in r.variables)d.variables[key]=r.variables[key];else for(key in r)d.variables[key]=r[key];let m=new XMLHttpRequest;m.open("POST",a.url),m.setRequestHeader("Content-type","application/json"),m.setRequestHeader("X-Requested-With","XMLHttpRequest"),m.onreadystatechange=function(){if(4===this.readyState&&200===this.status){let t=JSON.parse(this.responseText);e.setAttribute("data-success-url",l(o,t)),location.href=l(o,t)}},m.send((p=d,console.log("create context"),Object.keys(a.context).forEach(function(e){!Object.keys(p).includes(e)&&(p[e]={})}),JSON.stringify(t?(u=p,new URLSearchParams(window.location.search).forEach(function(e,t){!u.variables.hasOwnProperty(t)&&(u.variables[t]=e)}),u):p)))}else{if(console.log("func is not messenger"),r.variables)for(key in r.variables)i[key]=r.variables[key];else for(key in r)i[key]=r[key];o.indexOf("?")>1?(e.setAttribute("data-success-url",o+"&"+f(t?c(i):i)),location.href=o+"&"+f(t?c(i):i)):(e.setAttribute("data-success-url",o+"?"+f(t?c(i):i)),location.href=o+"?"+f(t?c(i):i))}}}function l(e,t){console.log("generate url");let r=a.messengers.find(function(t){return t.prefixes.find(function(t){return 0===e.indexOf(t)})});if(!r)return e;let n=e.split(r.key),i=n[1].split("&");return i.forEach(function(e,n){let s=e.split("=");if(r.parameter===s[0]){if("wa"===r.name){let o=s[1].split("+"),l=o.length,f=s[1].replace(o[l-1],btoa(atob(o[l-1])+a.delimiter+t.id).replace(/=/g,""));i.splice(n,1,[r.parameter,f].join("="))}else{let c=btoa(atob(s[1])+a.delimiter+t.id).replace(/=/g,"");i.splice(n,1,[r.parameter,c].join("="))}}}),n[0]+r.key+i.join("&")}function f(e,t){if(void 0===e||"object"!=typeof e)return e;let r=[];for(let n in e)if(e.hasOwnProperty(n)){let a=t?t+"["+n+"]":n,i=e[n];r.push("object"==typeof v?serialize(i,a):encodeURIComponent(a)+"="+encodeURIComponent(i))}return r.join("&")}function c(e){return new URLSearchParams(window.location.search).forEach(function(t,r){!e.hasOwnProperty(r)&&(e[r]=t)}),e}"loading"!==document.readyState?i():document.addEventListener("DOMContentLoaded",i)};
